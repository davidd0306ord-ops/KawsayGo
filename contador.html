<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KawsayGo ‚Äî Contador conectado</title>
<style>
  :root{--bg:#f2f7ff;--card:#fff;--accent:#00b36b;--muted:#6b7280}
  body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);margin:0;color:#111}
  .wrap{max-width:760px;margin:36px auto;padding:18px}
  .card{background:var(--card);padding:24px;border-radius:12px;box-shadow:0 8px 30px rgba(3,10,25,0.08)}
  h1{margin:0 0 8px;font-size:1.6rem;color:var(--accent)}
  p.lead{margin:0 0 16px;color:var(--muted)}
  .bigcount{font-size:4.2rem;font-weight:700;margin:12px 0;color:#0b3f2f}
  .progress-wrap{background:#e7eef0;border-radius:16px;padding:10px}
  .progress-bar{height:20px;background:linear-gradient(90deg,var(--accent),#66d69a);width:0;border-radius:12px;transition:width 1200ms ease}
  .controls{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
  button{padding:10px 14px;border-radius:10px;border:0;font-weight:600;cursor:pointer}
  .btn-add{background:#a8e6c8;color:#064b36}
  .btn-reset{background:#ffd5d5;color:#6b0b0b}
  .hint{margin-top:14px;color:#374151}
  .diag{margin-top:16px;background:#f8fafb;padding:12px;border-radius:10px;color:#111}
  .small{font-size:0.9rem;color:var(--muted)}
  .footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem}
  @media(max-width:640px){.bigcount{font-size:3rem}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Tu progreso ‚Äî KawsayGo</h1>
      <p class="lead">Aqu√≠ ver√°s un porcentaje estimado de tu estado actual basado en tu diagn√≥stico. Usa esto como un punto de partida para el plan diario.</p>

      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div>
            <div class="small">Racha actual</div>
            <div class="bigcount" id="diasDisplay">0</div>
            <div class="small">d√≠as sin reca√≠da</div>
          </div>
          <div style="flex:1;margin-left:12px">
            <div class="small">Progreso estimado</div>
            <div class="progress-wrap" aria-hidden="true" style="margin-top:8px">
              <div id="barra" class="progress-bar" style="width:0%"></div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <div class="small">0%</div>
              <div class="small" id="pctLabel">--%</div>
              <div class="small">100%</div>
            </div>
          </div>
        </div>

        <div class="controls">
          <button class="btn-add" onclick="sumarDia()">‚úî Marcar d√≠a completado</button>
          <button class="btn-reset" onclick="confirmarReinicio()">üîÅ Reca√≠ ‚Äî reiniciar</button>
        </div>

        <div class="hint">
          <strong>Consejo:</strong> Si no realizaste el diagn√≥stico, ve a <a href="diagnostico.html">Diagn√≥stico</a> para obtener una recomendaci√≥n personalizada.
        </div>

        <div class="diag" id="diagBox">
          <div class="small">Cargando diagn√≥stico...</div>
        </div>

        <div style="margin-top:14px" id="mensajeBox"></div>

      </div>
    </div>

    <div class="footer">KawsayGo ‚Äî Tu energ√≠a, tu direcci√≥n. Guardado localmente en tu navegador.</div>
  </div>

<script>
// ---------- UTILIDADES ----------
function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

// ---------- CARGA / GUARDADO DE DIAGN√ìSTICO ----------
function leerDiagnostico(){
  try{
    const raw = localStorage.getItem('diagnosticoKawsayGo');
    if(!raw) return null;
    return JSON.parse(raw);
  }catch(e){ return null; }
}

// ---------- CARGA / GUARDADO CONTADOR ----------
function leerDias(){
  return parseInt(localStorage.getItem('contadorKawsayGo') || '0', 10);
}
function guardarDias(n){
  localStorage.setItem('contadorKawsayGo', String(n));
}

// ---------- L√ìGICA DE C√ÅLCULO DEL PROGRESO ----------
function scoreFromDiagnostico(diag){
  // valores base por frecuencia
  const freq_map = {
    'diario': 0,
    'semanal': 20,
    'quincenal': 40,
    'mensual': 60,
    'mas': 80
  };
  const causa_adj_map = {
    'contenido': -10,
    'estres': -8,
    'soledad': -6,
    'aburrimiento': -4,
    'tristeza': -6,
    'habito': -2
  };
  const hora_adj_map = {'manana': 5, 'tarde':2, 'noche':-5, 'madrugada':-8};

  let base = freq_map[diag.frecuencia] ?? 20;
  const impulso = parseInt(diag.impulso || '3', 10);
  let impulse_penalty = impulso * 15; // 1->15, 5->75

  let causa_adj = causa_adj_map[diag.causa] ?? 0;
  let hora_adj = hora_adj_map[diag.hora] ?? 0;

  // f√≥rmula
  let raw = base - (impulse_penalty * 0.5) + causa_adj + hora_adj;
  // centramos y normalizamos a 0..100 (experimental)
  let porcentaje = (raw + 100) / 2;
  porcentaje = Math.round(clamp(porcentaje, 0, 100));
  return porcentaje;
}

// ---------- RENDER / UI ----------
function actualizarUI(){
  // dias
  const dias = leerDias();
  document.getElementById('diasDisplay').textContent = dias;

  // diagnostico
  const diag = leerDiagnostico();
  const diagBox = document.getElementById('diagBox');
  if(!diag){
    diagBox.innerHTML = '<div class="small">No hay diagn√≥stico guardado. <a href="diagnostico.html">Realizar diagn√≥stico</a></div>';
    // fallback: progreso neutral
    setProgreso(48, 'Sin diagn√≥stico, usamos valor neutro. Haz el diagn√≥stico para una recomendaci√≥n precisa.');
    return;
  }

  // mostrar resumen
  diagBox.innerHTML = `<div class="small">Resumen: frecuencia: <strong>${diag.frecuencia}</strong> ‚Äî impulso: <strong>${diag.impulso}</strong> ‚Äî causa: <strong>${diag.causa}</strong> ‚Äî hora cr√≠tica: <strong>${diag.hora}</strong></div>`;

  // calcular porcentaje real
  const pct = scoreFromDiagnostico(diag);
  // si tienes racha muy alta, mejoramos un poco el pct (refuerza h√°bito)
  const bonusRacha = Math.min(10, Math.floor(dias / 7) * 2); // +2% por cada semana completada, hasta 10
  const pctFinal = clamp(pct + bonusRacha, 0, 100);

  setProgreso(pctFinal, generarMensaje(pctFinal, diag, dias));
}

function setProgreso(pct, mensaje){
  document.getElementById('barra').style.width = pct + '%';
  document.getElementById('pctLabel').textContent = pct + '%';
  document.getElementById('mensajeBox').innerHTML = `<div class="small" style="margin-top:12px">${mensaje}</div>`;
}

// Mensaje motivacional y recomendaciones personalizadas
function generarMensaje(pct, diag, dias){
  let m = "";
  if(pct < 30) m = "Tu situaci√≥n requiere atenci√≥n: prioriza sue√±o, corta acceso a est√≠mulos y pide ayuda si es necesario.";
  else if(pct < 55) m = "Buen comienzo: trabaja en rutinas (sue√±o, ejercicio, evitar pantallas por la noche).";
  else if(pct < 80) m = "Vas por buen camino: fortalece h√°bitos, a√±ade ejercicio y tiempo con personas que te apoyen.";
  else m = "Excelente progreso: mant√©n tu racha, ayuda a otros y establece metas a 30/60 d√≠as.";

  // recomendaciones seg√∫n causas
  if(diag.causa === 'contenido') m += " Evita navegadores en inc√≥gnito y apps gatillo (usa bloqueadores).";
  if(diag.causa === 'estres') m += " Incorpora respiraciones cortas y micro-descansos de 3 minutos.";
  if(diag.causa === 'soledad') m += " Intenta conectar 2 veces a la semana con alguien (llamada o salir).";
  if(diag.hora === 'madrugada') m += " Procura cargar el celular fuera del cuarto y mejorar higiene de sue√±o.";

  // si dias es 0
  if(dias === 0) m = "A√∫n no inicias tu contador. Marca tu primer d√≠a cuando est√©s listo.";

  return m;
}

// ---------- INTERACCI√ìN ----------
function sumarDia(){
  let dias = leerDias();
  dias++;
  guardarDias(dias);
  actualizarUI();
}

function confirmarReinicio(){
  if(confirm("Si reinicias, perder√°s tu racha. ¬øConfirmar reinicio?")){
    guardarDias(0);
    actualizarUI();
  }
}

// Inicializa
actualizarUI();
</script>
</body>
</html>
